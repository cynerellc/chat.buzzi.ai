# Step 13: Company Admin - Conversations History

## Objective
Implement the conversations management interface for Company Admins to view, search, filter, and analyze all conversation history.

---

## Prerequisites
- Step 12 completed
- Database schema with conversations and messages tables
- Agents created

---

## Reference Documents
- [UI: Conversations](../ui/company-admin/07-conversations.md)
- [UI: Conversation Detail](../ui/company-admin/08-conversation-detail.md)

---

## Tasks

### 13.1 Create Conversations List Page

**Route:** `src/app/(company-admin)/conversations/page.tsx`

**Features:**
- Conversation table with filters
- Search by customer, content
- Export functionality
- Bulk actions

### 13.2 Implement Conversations Table

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Conversations                                                     [â†“ Export]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Search conversations...                                                      â”‚
â”‚                                                                                 â”‚
â”‚ [All] [Active] [Resolved] [Escalated]   [All Agents â–¼] [All Channels â–¼] [Date â–¼]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚ â”‚ Customer       â”‚ Agent        â”‚ Channel â”‚ Status    â”‚ Started    â”‚ Messages â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ [Avatar]       â”‚              â”‚         â”‚           â”‚            â”‚          â”‚ â”‚
â”‚ â”‚ John Doe       â”‚ Support Bot  â”‚ ğŸ’¬ Widgetâ”‚ â— Active  â”‚ 5 min ago  â”‚ 12       â”‚ â”‚
â”‚ â”‚ john@email.com â”‚              â”‚         â”‚           â”‚            â”‚          â”‚ â”‚
â”‚ â”‚                â”‚              â”‚         â”‚           â”‚            â”‚          â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ [Avatar]       â”‚              â”‚         â”‚           â”‚            â”‚          â”‚ â”‚
â”‚ â”‚ Jane Smith     â”‚ Sales Bot    â”‚ ğŸ’¬ Widgetâ”‚ âœ“ Resolvedâ”‚ 2 hrs ago  â”‚ 8        â”‚ â”‚
â”‚ â”‚ jane@corp.com  â”‚              â”‚         â”‚ AI        â”‚            â”‚          â”‚ â”‚
â”‚ â”‚                â”‚              â”‚         â”‚           â”‚            â”‚          â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ [Avatar]       â”‚              â”‚         â”‚           â”‚            â”‚          â”‚ â”‚
â”‚ â”‚ Bob Wilson     â”‚ Support Bot  â”‚ ğŸ“± WhatsAppâ”‚ğŸ§‘ Escalatedâ”‚ 1 day ago â”‚ 23       â”‚ â”‚
â”‚ â”‚ +1555123...    â”‚ â†’ Sarah (H)  â”‚         â”‚           â”‚            â”‚          â”‚ â”‚
â”‚ â”‚                â”‚              â”‚         â”‚           â”‚            â”‚          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚ Showing 1-25 of 1,234 conversations                        [< 1 2 3 ... 50 >]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.3 Implement Filters

**Status Tabs:**
- All - All conversations
- Active - Currently ongoing
- Resolved - Completed conversations
- Escalated - Transferred to human

**Dropdown Filters:**
- Agent - Filter by AI agent
- Channel - Widget, WhatsApp, Slack, etc.
- Date Range - Custom date picker

**Search:**
- Customer name/email
- Message content
- Tags

### 13.4 Create Conversation Detail Page

**Route:** `src/app/(company-admin)/conversations/[conversationId]/page.tsx`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† Back to Conversations                                          [â†“ Export]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚                                â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚  Conversation Messages         â”‚  â”‚  Conversation Info                     â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚  Customer                              â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚  â”‚
â”‚ â”‚  ğŸ¤– Support Bot       10:30 AM â”‚  â”‚  [Avatar]                              â”‚  â”‚
â”‚ â”‚  Hi! How can I help you today? â”‚  â”‚  John Doe                              â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚  john@example.com                      â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚  +1 (555) 123-4567                     â”‚  â”‚
â”‚ â”‚  ğŸ‘¤ John              10:31 AM â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚  I can't login to my account   â”‚  â”‚  [View Full Profile]                   â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚  ğŸ¤– Support Bot       10:31 AM â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚ â”‚  I'd be happy to help with     â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚  your login issue. Can you     â”‚  â”‚  Conversation Details                  â”‚  â”‚
â”‚ â”‚  tell me the email address     â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚  â”‚
â”‚ â”‚  you're trying to use?         â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚  Status: âœ“ Resolved                    â”‚  â”‚
â”‚ â”‚  ğŸ‘¤ John              10:32 AM â”‚  â”‚  Channel: ğŸ’¬ Widget                    â”‚  â”‚
â”‚ â”‚  john@example.com              â”‚  â”‚  Agent: Support Bot                    â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚  Started: Jan 18, 10:30 AM             â”‚  â”‚
â”‚ â”‚  ğŸ¤– Support Bot       10:32 AM â”‚  â”‚  Resolved: Jan 18, 10:45 AM            â”‚  â”‚
â”‚ â”‚  I've sent a password reset    â”‚  â”‚  Duration: 15 minutes                  â”‚  â”‚
â”‚ â”‚  link to your email...         â”‚  â”‚  Messages: 12                          â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚  â”€â”€â”€ Conversation Resolved â”€â”€â”€ â”‚  â”‚  Rating: â­â­â­â­â­ (5/5)                 â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚  Rating: â­â­â­â­â­ (5/5)         â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚ â”‚  Feedback: "Very helpful!"     â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚                                â”‚  â”‚  AI Analysis                           â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚  â”‚
â”‚                                     â”‚                                        â”‚  â”‚
â”‚                                     â”‚  Topic: Password Reset                 â”‚  â”‚
â”‚                                     â”‚  Sentiment: Positive                   â”‚  â”‚
â”‚                                     â”‚  Resolution: AI Handled                â”‚  â”‚
â”‚                                     â”‚                                        â”‚  â”‚
â”‚                                     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚                                     â”‚                                        â”‚  â”‚
â”‚                                     â”‚  Tags                                  â”‚  â”‚
â”‚                                     â”‚  â”€â”€â”€â”€                                  â”‚  â”‚
â”‚                                     â”‚  [Login Issue] [Password Reset]        â”‚  â”‚
â”‚                                     â”‚  [+ Add Tag]                           â”‚  â”‚
â”‚                                     â”‚                                        â”‚  â”‚
â”‚                                     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚                                     â”‚                                        â”‚  â”‚
â”‚                                     â”‚  Internal Notes                        â”‚  â”‚
â”‚                                     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚  â”‚
â”‚                                     â”‚  No notes yet  [+ Add Note]            â”‚  â”‚
â”‚                                     â”‚                                        â”‚  â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.5 Implement Message Display

**Message Types:**

**AI Bot Message:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– Support Bot                                                       10:30 AM   â”‚
â”‚                                                                                 â”‚
â”‚ Hi! How can I help you today?                                                   â”‚
â”‚                                                                                 â”‚
â”‚ [Knowledge: FAQ Guide - "Getting Started"]                      [View Context] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Customer Message:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         ğŸ‘¤ John Doe   10:31 AM   â”‚
â”‚                                                                                 â”‚
â”‚                                          I can't login to my account            â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Human Agent Message:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¤ Sarah (Agent)                                                     10:35 AM   â”‚
â”‚                                                                                 â”‚
â”‚ Hi John, I'm taking over from the AI. Let me help you with this.               â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**System Event:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Escalated to Sarah (Support Agent) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    10:34 AM     â”‚
â”‚               Reason: Customer requested human agent                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.6 Implement AI Context Panel

Show what knowledge/context AI used:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Context for Response                                     [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚ Knowledge Retrieved                                             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚                                                                 â”‚
â”‚ ğŸ“„ FAQ Guide - "Password Reset Process"                         â”‚
â”‚    Relevance: 92%                                               â”‚
â”‚    "To reset your password, click the 'Forgot Password'         â”‚
â”‚    link on the login page and enter your email..."              â”‚
â”‚                                                                 â”‚
â”‚ ğŸ“„ Support Documentation - "Account Access"                     â”‚
â”‚    Relevance: 78%                                               â”‚
â”‚    "If you're having trouble accessing your account,            â”‚
â”‚    first verify that you're using the correct email..."         â”‚
â”‚                                                                 â”‚
â”‚ Model Response                                                  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚                                                                 â”‚
â”‚ Model: GPT-4 Turbo                                              â”‚
â”‚ Temperature: 0.7                                                â”‚
â”‚ Tokens: 156 input, 89 output                                    â”‚
â”‚ Latency: 1.2s                                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.7 Implement Customer Info Panel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customer                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚         [Avatar]                        â”‚
â”‚         John Doe                        â”‚
â”‚         john@example.com                â”‚
â”‚         +1 (555) 123-4567               â”‚
â”‚                                         â”‚
â”‚         Customer since: Jan 2024        â”‚
â”‚         Conversations: 5                â”‚
â”‚         Avg. satisfaction: 4.6/5        â”‚
â”‚                                         â”‚
â”‚         [View Full Profile]             â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.8 Implement Tags & Notes

**Add Tag:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Add Tag                             [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Current Tags                            â”‚
â”‚ [Login Issue Ã—] [Password Reset Ã—]      â”‚
â”‚                                         â”‚
â”‚ Add Tag                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Type to search or create...     â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                         â”‚
â”‚ Suggested                               â”‚
â”‚ [Technical] [Billing] [Feature]         â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          [Cancel][Save] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Add Internal Note:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Add Internal Note                   [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Customer seems frustrated.      â”‚     â”‚
â”‚ â”‚ May need follow-up call.        â”‚     â”‚
â”‚ â”‚                                 â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                         â”‚
â”‚ Only visible to your team               â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      [Cancel][Add Note] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.9 Implement Export Functionality

**Export Options:**
- Single conversation (PDF, JSON)
- Multiple conversations (CSV, JSON)
- Date range export

**Export Modal:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Export Conversations                [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ Date Range                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ Jan 1, 2024 - Jan 18, 2024      â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                         â”‚
â”‚ Include                                 â”‚
â”‚ â˜‘ Full message content                 â”‚
â”‚ â˜‘ Customer information                 â”‚
â”‚ â˜ AI context/reasoning                 â”‚
â”‚ â˜‘ Tags and notes                       â”‚
â”‚                                         â”‚
â”‚ Format                                  â”‚
â”‚ â— CSV  â—‹ JSON  â—‹ PDF                   â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   [Cancel][Export]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.10 Create Conversations API Routes

**`src/app/api/company/conversations/route.ts`:**
- GET: List conversations with filters, pagination

**`src/app/api/company/conversations/[conversationId]/route.ts`:**
- GET: Get conversation details with messages
- PATCH: Update conversation (tags, status)

**`src/app/api/company/conversations/[conversationId]/messages/route.ts`:**
- GET: Get messages with pagination

**`src/app/api/company/conversations/[conversationId]/notes/route.ts`:**
- GET: Get internal notes
- POST: Add internal note

**`src/app/api/company/conversations/[conversationId]/context/route.ts`:**
- GET: Get AI context for specific message

**`src/app/api/company/conversations/export/route.ts`:**
- POST: Export conversations

---

## Data Models

### Conversation
```typescript
interface Conversation {
  id: string;
  companyId: string;
  agentId: string;
  customerId: string;
  assignedUserId: string | null;
  channel: 'widget' | 'whatsapp' | 'telegram' | 'slack' | 'teams' | 'email';
  channelConversationId: string | null;
  status: 'active' | 'waiting' | 'resolved' | 'archived';
  resolution: 'ai' | 'human' | 'abandoned' | null;
  priority: number;
  tags: string[];
  metadata: {
    pageUrl?: string;
    referrer?: string;
    device?: string;
    topic?: string;
    sentiment?: 'positive' | 'neutral' | 'negative';
  };
  rating: number | null;
  feedback: string | null;
  startedAt: Date;
  resolvedAt: Date | null;
  createdAt: Date;
  updatedAt: Date;
}
```

### Message
```typescript
interface Message {
  id: string;
  conversationId: string;
  role: 'user' | 'assistant' | 'system';
  type: 'text' | 'image' | 'file' | 'system_event';
  content: string;
  attachments: Array<{
    type: string;
    url: string;
    name: string;
    size: number;
  }>;
  metadata: {
    modelUsed?: string;
    tokensUsed?: number;
    knowledgeUsed?: Array<{
      sourceId: string;
      chunkId: string;
      relevance: number;
    }>;
    agentId?: string;
    userId?: string;
    eventType?: string;
  };
  createdAt: Date;
}
```

---

## Validation Checklist

- [ ] Conversations list loads with data
- [ ] Filters work correctly
- [ ] Search works correctly
- [ ] Pagination works
- [ ] Conversation detail shows messages
- [ ] Customer info displays
- [ ] Tags can be added/removed
- [ ] Notes can be added
- [ ] AI context shows correctly
- [ ] Export generates correct file
- [ ] Click row navigates to detail

---

## File Structure

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (company-admin)/
â”‚   â”‚   â””â”€â”€ conversations/
â”‚   â”‚       â”œâ”€â”€ page.tsx
â”‚   â”‚       â””â”€â”€ [conversationId]/
â”‚   â”‚           â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ company/
â”‚           â””â”€â”€ conversations/
â”‚               â”œâ”€â”€ route.ts
â”‚               â”œâ”€â”€ export/
â”‚               â”‚   â””â”€â”€ route.ts
â”‚               â””â”€â”€ [conversationId]/
â”‚                   â”œâ”€â”€ route.ts
â”‚                   â”œâ”€â”€ messages/
â”‚                   â”‚   â””â”€â”€ route.ts
â”‚                   â”œâ”€â”€ notes/
â”‚                   â”‚   â””â”€â”€ route.ts
â”‚                   â””â”€â”€ context/
â”‚                       â””â”€â”€ route.ts
â”‚
â””â”€â”€ components/
    â””â”€â”€ company-admin/
        â””â”€â”€ conversations/
            â”œâ”€â”€ conversations-table.tsx
            â”œâ”€â”€ conversations-filters.tsx
            â”œâ”€â”€ conversation-detail.tsx
            â”œâ”€â”€ message-list.tsx
            â”œâ”€â”€ message-bubble.tsx
            â”œâ”€â”€ customer-info-panel.tsx
            â”œâ”€â”€ conversation-info-panel.tsx
            â”œâ”€â”€ ai-context-modal.tsx
            â”œâ”€â”€ add-tag-modal.tsx
            â”œâ”€â”€ add-note-modal.tsx
            â””â”€â”€ export-modal.tsx
```

---

## Next Step
[Step 14 - Team Management](./step-14-team-management.md)

---

## Related Documentation
- [UI: Conversations](../ui/company-admin/07-conversations.md)
- [UI: Conversation Detail](../ui/company-admin/08-conversation-detail.md)
